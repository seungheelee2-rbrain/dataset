<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Energy Law Data Explorer</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: { colors: { brand: { DEFAULT: '#FFA600' } } }
      }
    }
  </script>
  <style>
    .card { transition: box-shadow .2s ease, transform .2s ease; }
    .card:hover { box-shadow: 0 10px 24px rgba(0,0,0,.08); transform: translateY(-2px); }
    .tab-active { background:#FFA600; color:white; }
    .country-pill-active { background:#111827; color:white; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-orange-50 to-white">
  <header class="sticky top-0 z-30 backdrop-blur bg-white/70 border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <span class="text-2xl">🌐</span>
      <h1 class="text-xl font-semibold">Energy Law Data Explorer</h1>
      <span class="ml-auto text-xs px-2 py-1 border rounded">static</span>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="flex flex-col md:flex-row md:items-center gap-3">
      <div class="relative w-full md:max-w-xl">
        <input id="searchInput" type="text" class="w-full h-11 pl-10 pr-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/60" placeholder="검색: 법령명, 요약, 카테고리, 국가 …" />
        <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 4.22 12.02l4.26 4.25a.75.75 0 1 0 1.06-1.06l-4.25-4.26A6.75 6.75 0 0 0 10.5 3.75Zm-5.25 6.75a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Z" clip-rule="evenodd"/></svg>
      </div>
      <div class="flex items-center gap-2">
        <button id="resetBtn" class="h-11 px-3 border rounded-lg">초기화</button>
      </div>
    </div>

    <!-- Country pills -->
    <section class="mt-5">
      <div class="flex items-center gap-2 mb-2 text-gray-600 text-sm">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4.5A1.5 1.5 0 0 1 4.5 3h15A1.5 1.5 0 0 1 21 4.5v.75a.75.75 0 0 1-.75.75H3.75A.75.75 0 0 1 3 5.25V4.5ZM3 9.75c0-.414.336-.75.75-.75h16.5a.75.75 0 0 1 .75.75v.75a1.5 1.5 0 0 1-1.5 1.5H4.5A1.5 1.5 0 0 1 3 10.5v-.75ZM3 15.75c0-.414.336-.75.75-.75h16.5a.75.75 0 0 1 .75.75v.75A1.5 1.5 0 0 1 19.5 18h-15A1.5 1.5 0 0 1 3 16.5v-.75Z"/></svg>
        <span>국가 선택</span>
      </div>
      <div id="countryPills" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Category tabs -->
    <section class="mt-6">
      <div id="categoryTabs" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Results -->
    <section id="results" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></section>

    <section class="mt-10">
      <details class="border rounded-lg p-4 bg-white/70">
        <summary class="cursor-pointer font-medium">데이터 연결 방법 (JSON 교체)</summary>
        <ol class="list-decimal pl-6 space-y-2 text-sm text-gray-600 mt-3">
          <li>레포 루트(또는 <code>docs/</code>)에 <code>data.json</code>을 두고 아래 스키마로 저장하세요.</li>
          <li><code>country</code>, <code>category</code> 필드는 나라 및 종류 분류용으로 반드시 포함해야 합니다.</li>
          <li>GitHub Pages는 기본 브랜치의 <code>docs/</code> 또는 <code>root</code>를 서빙할 수 있습니다.</li>
        </ol>
        <pre class="mt-3 bg-slate-900 text-slate-50 p-3 text-xs rounded overflow-auto">[
  {"id":"kr-001","country":"Korea","category":"법률","title":"전기산업발전기본법","summary":"…","updatedAt":"2025-01-10","source":""},
  {"id":"jp-001","country":"Japan","category":"시행령","title":"재생가능에너지 특별조치법 시행령","summary":"…","updatedAt":"2022-04-01","source":""}
]</pre>
      </details>
    </section>
  </main>

  <footer class="border-t py-6 mt-12">
    <div class="max-w-6xl mx-auto px-4 text-sm text-gray-600">데이터 미리보기 UI · © <span id="year"></span></div>
  </footer>

  <script>
    const DATA = [];

    // Load external dataset by default
    fetch('data.json')
      .then(r=> r.ok ? r.json() : [])
      .then(json=>{ if (Array.isArray(json) && json.length){ DATA.splice(0, DATA.length, ...json); } init(); })
      .catch(()=>{ init(); });

    const state = { query:'', country:null, category:'ALL' };

    const CATEGORY_ORDER = ['법률','시행령','시행규칙','행정규칙','고시','운영규칙','정책','지침/기준','시장규칙','기타'];

    const flags = { 'Japan':'🇯🇵','United States':'🇺🇸','Australia':'🇦🇺','Korea':'🇰🇷','China':'🇨🇳','Germany':'🇩🇪','France':'🇫🇷','UK':'🇬🇧' };

    const resultsEl = document.getElementById('results');
    const searchInput = document.getElementById('searchInput');
    const resetBtn = document.getElementById('resetBtn');
    const countryPills = document.getElementById('countryPills');
    const categoryTabs = document.getElementById('categoryTabs');

    const uniq = arr => Array.from(new Set(arr));
    const debounce = (fn, ms=250) => { let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); }; };

    function matches(row){
      const mc = state.country ? row.country===state.country : true;
      const mcat = state.category==='ALL' ? true : row.category===state.category;
      const q = state.query.trim().toLowerCase();
      const text = `${row.title} ${row.summary} ${row.category} ${row.country}`.toLowerCase();
      const mq = q ? text.includes(q) : true;
      return mc && mcat && mq;
    }

    function formatDate(iso){ return iso; }

    function resultCard(row){
      const src = row.source ? `<a class="text-sm font-medium text-brand hover:underline inline-flex items-center" href="${row.source}" target="_blank" rel="noreferrer">출처 열기</a>` : `<span class="text-xs text-gray-500">출처 없음</span>`;
      return `<div class="card border rounded-xl bg-white p-4">
        <div class="flex items-start justify-between gap-4">
          <div class="min-w-0">
            <h3 class="text-lg font-semibold leading-snug break-words">${row.title}</h3>
            <div class="mt-1 flex flex-wrap items-center gap-2 text-sm">
              <span class="px-2 py-0.5 rounded border">${flags[row.country]||'🌐'} ${row.country}</span>
              <span class="px-2 py-0.5 rounded bg-brand text-white">${row.category}</span>
              <span class="text-xs text-gray-500">업데이트: ${formatDate(row.updatedAt)}</span>
            </div>
          </div>
        </div>
        <p class="mt-2 text-sm text-gray-700 leading-relaxed">${row.summary}</p>
        <div class="mt-3">${src}</div>
      </div>`;
    }

    function renderResults(){
      const list = DATA.filter(matches).sort((a,b)=> a.updatedAt < b.updatedAt ? 1 : -1);
      if(!list.length){
        resultsEl.innerHTML = `<div class='col-span-full border rounded-xl bg-white p-8 text-center text-sm text-gray-600'>결과가 없습니다.</div>`;
        return;
      }
      resultsEl.innerHTML = list.map(resultCard).join('');
    }

    function renderCountries(){
      const countries = uniq(DATA.map(d=>d.country)).sort();
      const pills = [`<button data-country="" class="px-3 h-9 rounded-full border ${state.country?'' :'country-pill-active'}">전체</button>`]
        .concat(countries.map(c=>`<button data-country="${c}" class="px-3 h-9 rounded-full border ${state.country===c?'country-pill-active':''}">${flags[c]||'🌐'} ${c}</button>`));
      countryPills.innerHTML = pills.join('');
      countryPills.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const c = btn.getAttribute('data-country');
          state.country = c? c : null;
          renderCountries();
          renderResults();
        });
      });
    }

    function renderCategories(){
      const categories = ['ALL', ...CATEGORY_ORDER.filter(c=>DATA.some(d=>d.category===c))];
      const tabs = categories.map(c=>`<button data-cat="${c}" class="px-3 h-9 rounded-full border ${state.category===c?'tab-active':''}">${c==='ALL'?'전체':c}</button>`);
      categoryTabs.innerHTML = tabs.join('');
      categoryTabs.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{
          state.category = btn.getAttribute('data-cat');
          renderCategories();
          renderResults();
        });
      });
    }

    const onSearch = debounce(v=>{ state.query = v; renderResults(); }, 250);

    function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      renderCountries();
      renderCategories();
      renderResults();
      searchInput.addEventListener('input', e=> onSearch(e.target.value));
      resetBtn.addEventListener('click', ()=>{
        state.query=''; state.country=null; state.category='ALL';
        searchInput.value='';
        renderCountries(); renderCategories(); renderResults();
      });
    }

    init();
  </script>
</body>
</html>
